model_id: hf-internal-testing/tiny-stable-diffusion-pipe
prompt:
  - "ornate wallpaper patterns repeating into the distance"
seed: 17
num_inference_steps: 30
guidance_scale: 7.5
samples_per_condition: 2
residual_layer_pattern: "(?:resnets|transformer_blocks)"
max_cache_layers: 64

echo:
  - name: residual-echo-ramp
    site:
      kind: diffusion.residual
      layer_regex: "down_blocks\\.[0-2]\\..*(?:resnets|transformer_blocks)"
      timestep_start: 8
      timestep_end: 24
    actuator:
      type: residual_echo
      params:
        alpha: 0.35
    schedule:
      mode: ramp
      strength: 1.0
      strength_start: 0.2
      strength_end: 1.0
    trace:
      metrics: [activation_norm, activation_delta_norm]
      sample_every: 1

counter:
  - name: residual-breaker-clamp
    site:
      kind: diffusion.residual
      layer_regex: "up_blocks\\.[0-2]\\..*(?:resnets|transformer_blocks)"
      timestep_start: 24
      timestep_end: 29
    actuator:
      type: residual_clamp
      params:
        max_norm: 16.0
    schedule:
      mode: window
      strength: 1.0
    trace:
      metrics: [activation_delta_norm]
      sample_every: 1
