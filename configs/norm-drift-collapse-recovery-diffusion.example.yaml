model_id: hf-internal-testing/tiny-stable-diffusion-pipe
prompt:
  - "a cinematic city skyline at dusk"
seed: 11
num_inference_steps: 30
guidance_scale: 7.5
samples_per_condition: 2

collapse:
  - name: norm-collapse-gain
    site:
      kind: diffusion.norm
      layer_regex: "down_blocks\\.[0-2]\\..*(?:norm|ln|layernorm)"
      timestep_start: 8
      timestep_end: 18
    actuator:
      type: norm_gain_drift
      params:
        scale: 0.9
    schedule:
      mode: ramp
      strength: 1.0
      strength_start: 0.2
      strength_end: 1.0
    trace:
      metrics: [norm_output_mean, norm_output_var]
      sample_every: 1

counter:
  - name: norm-recovery-bias
    site:
      kind: diffusion.norm
      layer_regex: "up_blocks\\.[0-2]\\..*(?:norm|ln|layernorm)"
      timestep_start: 19
      timestep_end: 29
    actuator:
      type: norm_bias_shift
      params:
        bias: -0.2
    schedule:
      mode: window
      strength: 0.7
    trace:
      metrics: [norm_output_var]
      sample_every: 1
